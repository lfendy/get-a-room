<html>
  <head>
  </head>
  <body>
    <div id="main">
     <canvas id="roomCanvas"></canvas>
    </div>
    <div id="footer">
    <div id="slide" class="centre"></div>
    </div>


    <script src="js/lib/jquery-2.1.0.min.js"></script>
    <script src="js/lib/jquery-ui-1.11.2.custom/jquery-ui.js"></script>
    <script src="js/lib/no-ui-slider/jquery.nouislider.all.js"></script>
    <link rel="stylesheet" href="css/spike.css">
    <link rel="stylesheet" href="js/lib/jquery-ui-1.11.2.custom/jquery-ui.css">
    <link rel="stylesheet" href="js/lib/no-ui-slider/jquery.nouislider.css">
    <script type="text/javascript" src="js/lib/canvaslayers.js"></script>
    <script type="text/javascript" src="js/spike.js"></script>
    <script>


    var initSlide = function(){
      $("#slide").noUiSlider({
        start: [28, 30],
        connect: true,
        step: 1,
        range: {
          'min': 14,
          'max': 38
        },
        behaviour: 'tap-drag',
      });
        //$("#slider").width("80%");
//        $("#slider").position({
//          my: "center",
//          at: "right"
//          of: $("#slider").parent();
//          });
    };

    var isAvailable = function(start, end, roomName, data) {
      var available = true;
      var roomData = data[roomName];
      var availability = roomData.substring(start, end);
      available = !availability.contains("1");
      return available;
    };

    var createAvailabilityMap = function(start, end, data){
      var boardRoom = isAvailable(start, end, "boardRoom", data);
      var room1 = isAvailable(start, end, "meetingRoomOne", data);
      var room2 = isAvailable(start, end, "meetingRoomTwo", data);
      var room3 = isAvailable(start, end, "meetingRoomThree", data);
      var room4 = isAvailable(start, end, "meetingRoomFour", data);
      var room5 = isAvailable(start, end, "meetingRoomFive", data);
      var room6 = isAvailable(start, end, "meetingRoomSix", data);

      return {
        boardRoom: boardRoom,
        room1: room1,
        room2: room2,
        room3: room3,
        room4: room4,
        room5: room5,
        room6: room6
      };
    };


    var reDraw = function(data){
      window.awesome = data;
      var newMap = createAvailabilityMap(21,22,data);
      spike.draw(newMap);
      console.log("OK");
    };

    var getAvailability = function(){
      return $.get('resources/availability.json', reDraw);
    };

    var init = function(){
      spike.draw();
      getAvailability();
      initSlide();
    };

    $(document).ready(init);
    $(window).resize(spike.draw);

    </script>
  </body>
</html>
